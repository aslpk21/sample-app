trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

steps:
  - checkout: self

  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.9'
    displayName: 'Set up Python'

  - script: |
      python -m pip install --upgrade pip
      pip install flask
    displayName: 'Install Flask'

  # Chạy Flask + curl + lưu và in response
  - script: |
      echo "Starting Flask server..."
      python sample_app.py &
      sleep 5

      echo "Sending request to Flask endpoint..."
      curl -s http://localhost:5050/ > response.txt

      echo "===== Flask Response Start ====="
      cat response.txt
      echo "===== Flask Response End ====="
    displayName: 'Run Flask and capture response'

  - script: |
      echo "Build completed!"
    displayName: 'Build step'